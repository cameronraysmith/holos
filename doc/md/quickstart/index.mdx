import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Admonition from '@theme/Admonition';

# Quickstart Guide

This guide shows you the basics of how Holos.  You'll deploy a Helm chart to
Kubernetes using a Component to see how Holos makes the process safer, easier,
and more consistent.

## What you'll need {#Requirements}

You'll need the following tools installed to complete this guide.

1. [holos](/docs/install) - to build the platform.
2. [helm](https://helm.sh/docs/intro/install/) - to render Holos components that wrap upstream Helm charts.
3. [k3d](https://k3d.io/#installation) - to provide a Kubernetes API server.
4. [OrbStack](https://docs.orbstack.dev/install) or [Docker](https://docs.docker.com/get-docker/) - to use k3d.
5. [kubectl](https://kubernetes.io/docs/tasks/tools/) - to interact with the k8s api server.

## Install Holos

Install Holos with the following command or other methods listed on the
[Installation](/docs/install/) page.

```bash
go install github.com/holos-run/holos/cmd/holos@latest
```

## Git repository

Start by initializing an empty Git repository.  Holos is designed to operate
against local files in a Git repository.

<Tabs groupId="init">
  <TabItem value="command" label="Command">
    ```bash
    mkdir holos-quickstart
    cd holos-quickstart
    git init
    ```
  </TabItem>
  <TabItem value="output" label="Output">
    ```txt
    Initialized empty Git repository in /holos-quickstart/.git/
    ```
  </TabItem>
</Tabs>

This guide assumes commands are run from the root directory of this Git
repository unless otherwise stated.

## Generate the Platform {#Generate-Platform}

Generate the Platform code in the repository root.  A Platform refers to all of
the software and services integrated together to provide your organization's
software development platform.  In this guide the platform will contain a single
Component to demonstrate how the concepts fit together.

```bash
holos generate platform quickstart
```

Commit the generated platform config to the repository.

```bash
git add .
git commit -m "holos generate platform quickstart - $(holos --version)"
```

## Create a Component

The platform you generated is empty.  Rendering the platform succeeds, but does
nothing because there are no Components listed in the Platform spec:

```cue
package holos

import core "github.com/holos-run/holos/api/core/v1alpha3"

core.#Platform & {
	metadata: name: "quickstart"
}
```

<Tabs groupId="render">
  <TabItem value="command" label="Command">
    ```bash
    holos render platform ./platform
    ```
  </TabItem>
  <TabItem value="output" label="Output">
    ```bash
    # No output is produced, the Platform contains no Components.
    ```
  </TabItem>
</Tabs>

Generate the CUE code definition for a Component that wraps the podinfo Helm
chart.

<Tabs groupId="gen-podinfo">
  <TabItem value="command" label="Command">
    ```bash
    mkdir -p components
    (cd components && holos generate component helm podinfo)
    ```
  </TabItem>
  <TabItem value="output" label="Output">
    ```txt
    generated component
    ```
  </TabItem>
</Tabs>

The HelmChart Component is defined in the `components/podinfo/podinfo.cue` file, for example:

```cue
package holos

import schema "github.com/holos-run/holos/api/schema/v1alpha3"

// Produce a helm chart build plan.
(schema.#Helm & Chart).Output

let Chart = {
	Name:      "podinfo"
	Version:   "6.6.2"
	Namespace: "default"

	Repo: name: "podinfo"
	Repo: url:  "https://stefanprodan.github.io/podinfo"

	Values: {}
}
```

In this example we're providing the minimal information about the Helm chart we
want to manage in this Component.  The name, version, Kubernetes namespace to
deploy into, and the chart repository location.

This chart deploys cleanly with no values provided, but we include an empty
struct to illustrate how Holos improves the consistency and safety of Helm
values by taking advantage the strong type checking in CUE.  Shared values, such
as the organization domain name, can safely be passed to all Components across
all clusters in the Platform.

## Render the Component

Individual components can be rendered without needing to be included in a
Platform spec, useful when developing a new component.

<Tabs groupId="render-podinfo">
  <TabItem value="command" label="Command">
    ```bash
    holos render component ./components/podinfo --cluster-name=default
    ```
  </TabItem>
  <TabItem value="output" label="Output">
    ```txt
    cached
    rendered podinfo
    ```
  </TabItem>
</Tabs>

First, the command caches the helm chart locally to speed up subsequent
renderings.  Then the command executes helm to produce the output which is
written into the deploy directory.

<Tabs groupId="tree-podinfo">
  <TabItem value="command" label="Command">
    ```bash
    tree deploy
    ```
  </TabItem>
  <TabItem value="output" label="Output">
    ```txt
    deploy
    └── clusters
        └── default
            └── components
                └── podinfo
                    └── podinfo.gen.yaml
    ```
  </TabItem>
</Tabs>

The component is deployed to one cluster named default. The same component is
often deployed to multiple clusters, for example east and west for reliability.

This example is equivalent to executing `helm template` on the chart.
